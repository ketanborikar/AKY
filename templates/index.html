<script>
    document.addEventListener("DOMContentLoaded", function() {
        const socket = io.connect(window.location.origin); 
        let userName = "";

        function joinChat() {
            userName = document.getElementById("nameInput").value.trim();
            if (userName) {
                document.getElementById("nameSection").style.display = "none";
                document.getElementById("chatSection").style.display = "block";
            }
        }

        document.getElementById("messageInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });

        function sendMessage() {
            const message = document.getElementById("messageInput").value.trim();
            if (message) {
                socket.send(`${userName}: ${message}`);
                document.getElementById("messageInput").value = "";
            }
        }

        socket.on("message", (msg) => {
            const chatBox = document.getElementById("chatBox");
            const messageElement = document.createElement("p");
            messageElement.textContent = msg;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to latest message
        });

        // Attach event listener after DOM loads
        document.getElementById("nameInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                joinChat();
            }
        });

        document.getElementById("sendButton").addEventListener("click", sendMessage);
        document.getElementById("nameInput").nextElementSibling.addEventListener("click", joinChat);
    });
</script>
