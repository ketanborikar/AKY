<script>
    document.addEventListener("DOMContentLoaded", function() {
        const socket = io.connect(window.location.origin); 
        let userName = "";

        function joinChat() {
            userName = document.getElementById("nameInput").value.trim();
            if (userName) {
                document.getElementById("nameSection").style.display = "none";
                document.getElementById("chatSection").style.display = "block";
                socket.emit("join", userName);  // Notify server
            }
        }

        function sendMessage() {
            const message = document.getElementById("messageInput").value.trim();
            if (message) {
                socket.send(`${userName}: ${message}`);
                document.getElementById("messageInput").value = "";
            }
        }

        socket.on("message", (msg) => {
            const chatBox = document.getElementById("chatBox");
            const messageElement = document.createElement("p");
            messageElement.textContent = msg;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        window.addEventListener("beforeunload", function() {
            socket.emit("leave", userName);  // Notify when closing the site
        });

        // Ensure buttons reference existing functions
        document.getElementById("nameInput").nextElementSibling.addEventListener("click", joinChat);
        document.getElementById("sendButton").addEventListener("click", sendMessage);
    });
</script>
